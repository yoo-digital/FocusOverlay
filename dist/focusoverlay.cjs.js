/* Focus Overlay - v1.0.0
* https://github.com/yoo-digital/FocusOverlay
* Copyright (c) 2020 YOO AG. Licensed MIT */
"use strict";var __assign=function(){return(__assign=Object.assign||function(t){for(var e,o=1,i=arguments.length;o<i;o++)for(var n in e=arguments[o])Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t}).apply(this,arguments)},debounce=function(t,e){var o;return function(){for(var i=[],n=0;n<arguments.length;n++)i[n]=arguments[n];clearTimeout(o),o=window.setTimeout(function(){return t.apply(void 0,i)},e)}},whichTransitionEvent=function(){var t=document.createElement("fakeelement");return Object.values({transition:"transitionend",OTransition:"oTransitionEnd",MozTransition:"transitionend",WebkitTransition:"webkitTransitionEnd"}).forEach(function(e){return void 0!==t.style[e]?e:""}),""},absolutePosition=function(t){var e,o=0,i=0,n=0,s=0,r=document.createElement("div");if(document.body&&(r.style.cssText="position:absolute;left:0;top:0",document.body.appendChild(r)),t&&t.ownerDocument===document&&"getBoundingClientRect"in t&&r){var a=t.getBoundingClientRect(),c=r.getBoundingClientRect();e=!0,o=a.left-c.left,i=a.top-c.top,n=a.right-a.left,s=a.bottom-a.top}return{found:e,left:o,top:i,width:n,height:s,right:o+n,bottom:i+s}},nothing=function(){},FocusOverlay=function(){function t(t,e){var o=this;this.active=!1,this.scopedEl=null,this.focusBox=null,this.currentTarget=null,this.previousTarget=null,this.nextTarget=null,this.timeout=setTimeout(nothing,1),this.transitionEvent=whichTransitionEvent(),this.options=__assign({class:"focus-overlay",activeClass:"focus-overlay-active",animatingClass:"focus-overlay-animating",targetClass:"focus-overlay-target",zIndex:9001,duration:500,inActiveAfterDuration:!1,triggerKeys:[9,36,37,38,39,40,13,32,16,17,18,27],inactiveOnNonTriggerKey:!0,inactiveOnClick:!0,alwaysActive:!1,watchTransitionEnd:!0,debounceScroll:!0,debounceResize:!0,debounceMs:150,onInit:nothing,onBeforeMove:nothing,onAfterMove:nothing,onDestroy:nothing},e),t instanceof HTMLElement?this.scopedEl=t:this.scopedEl="string"==typeof t?document.querySelector(t):document.querySelector("body"),this.onKeyDownHandler=this.onKeyDownHandler.bind(this),this.onFocusHandler=this.onFocusHandler.bind(this),this.moveFocusBox=this.moveFocusBox.bind(this),this.stop=this.stop.bind(this),this.debouncedMoveFocusBox=debounce(function(t){return o.moveFocusBox(t)},this.options.debounceMs),this.init()}return t.prototype.init=function(){this.options.alwaysActive?(this.active=!0,window.addEventListener("focusin",this.onFocusHandler,!0)):(window.addEventListener("keydown",this.onKeyDownHandler,!1),this.options.inactiveOnClick&&window.addEventListener("mousedown",this.stop,!1)),this.createFocusBox(),this.options.onInit(this)},t.prototype.onKeyDownHandler=function(t){var e=this,o=t.which;this.options.triggerKeys.includes(o)?(!1===this.active&&(this.active=!0,window.addEventListener("focusin",this.onFocusHandler,!0),this.options.debounceScroll&&window.addEventListener("scroll",this.debouncedMoveFocusBox,!0),this.options.debounceResize&&window.addEventListener("resize",this.debouncedMoveFocusBox,!1)),setTimeout(function(){var t,o=document.activeElement;o instanceof HTMLIFrameElement&&(null===(t=e.scopedEl)||void 0===t?void 0:t.contains(o))&&!0===e.active&&e.moveFocusBox(o)},5)):this.options.inactiveOnNonTriggerKey&&this.stop()},t.prototype.createFocusBox=function(){var t;this.focusBox=document.createElement("div"),this.focusBox.setAttribute("aria-hidden","true"),this.focusBox.classList.add(this.options.class),Object.assign(this.focusBox.style,{position:"absolute",zIndex:this.options.zIndex,pointerEvents:"none"}),null===(t=this.scopedEl)||void 0===t||t.insertAdjacentElement("beforeend",this.focusBox)},t.prototype.cleanup=function(){null!=this.nextTarget&&(this.previousTarget=this.nextTarget,this.previousTarget.classList.remove(this.options.targetClass),this.previousTarget.removeEventListener(this.transitionEvent,this.moveFocusBox))},t.prototype.onFocusHandler=function(t){var e,o=t.target;if(this.cleanup(),null===(e=this.scopedEl)||void 0===e?void 0:e.contains(o)){var i=this.nextTarget,n=o.getAttribute("data-focus");if(null!==n)this.nextTarget=o.closest(n);else if(null!==o.getAttribute("data-focus-label")){var s=document.querySelector("[for='"+o.id+"']");null===s&&(s=o.closest("label")),this.nextTarget=s}else{if(null!==o.getAttribute("data-focus-ignore"))return;this.nextTarget=o}this.currentTarget=this.nextTarget,clearTimeout(this.timeout),this.transitionEvent&&this.options.watchTransitionEnd&&this.nextTarget&&this.nextTarget.addEventListener(this.transitionEvent,this.moveFocusBox),this.options.onBeforeMove(i,this.nextTarget,this),this.moveFocusBox(this.nextTarget)}else this.options.alwaysActive||this.stop()},t.prototype.stop=function(){var t;this.active=!1,window.removeEventListener("focusin",this.onFocusHandler,!0),this.options.debounceScroll&&window.removeEventListener("scroll",this.debouncedMoveFocusBox,!0),this.options.debounceResize&&window.removeEventListener("resize",this.debouncedMoveFocusBox,!1),this.cleanup(),null===(t=this.focusBox)||void 0===t||t.classList.remove(this.options.activeClass)},t.prototype.moveFocusBox=function(t){var e,o=this;t instanceof Event&&(t=this.currentTarget);var i=t;if(null==i||i.classList.add(this.options.targetClass),document.body.contains(i)&&i instanceof HTMLElement&&this.focusBox){var n=absolutePosition(i),s=n.width+"px",r=n.height+"px",a=n.left+"px",c=n.top+"px";this.focusBox.classList.add(this.options.animatingClass),this.focusBox.classList.add(this.options.activeClass),Object.assign(null===(e=this.focusBox)||void 0===e?void 0:e.style,{width:s,height:r,left:a,top:c}),this.timeout=setTimeout(function(){var t,e;null===(t=o.focusBox)||void 0===t||t.classList.remove(o.options.animatingClass),o.options.inActiveAfterDuration&&(null===(e=o.focusBox)||void 0===e||e.classList.remove(o.options.activeClass)),o.options.onAfterMove(o.previousTarget,i,o)},this.options.duration)}else this.cleanup()},t.prototype.destroy=function(){var t,e,o,i;null===(e=null===(t=this.focusBox)||void 0===t?void 0:t.parentNode)||void 0===e||e.removeChild(this.focusBox),null===(o=this.previousTarget)||void 0===o||o.classList.remove(this.options.targetClass),null===(i=this.nextTarget)||void 0===i||i.classList.remove(this.options.targetClass),window.removeEventListener("focusin",this.onFocusHandler,!0),window.removeEventListener("keydown",this.onKeyDownHandler,!1),window.removeEventListener("mousedown",this.stop,!1),this.options.debounceScroll&&window.removeEventListener("scroll",this.debouncedMoveFocusBox,!0),this.options.debounceResize&&window.removeEventListener("resize",this.debouncedMoveFocusBox,!1),this.options.onDestroy(this)},t}();module.exports=FocusOverlay;
